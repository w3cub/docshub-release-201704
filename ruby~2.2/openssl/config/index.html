
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>OpenSSL&#58;&#58;Config - Ruby 2.2 - W3cubDocs</title>
  
  <meta name="description" content=" Configuration for the openssl library. ">
  <meta name="keywords" content="class, openssl, config, -, ruby, ruby~2.2">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/ruby~2.2/openssl/config/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/ruby~2.2.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ruby~2.2/" class="_nav-link" title="" style="margin-left:0;">Ruby 2.2</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _rdoc">
				
<h1 id="class-OpenSSL::Config" class="class"> class OpenSSL::Config </h1>
<dl class="meta">
<dt>Parent:</dt>
<dd class="meta-parent"><a href="../../object/">Object</a></dd>
<dt>Included modules:</dt>
<dd class="meta-includes"><a class="include" href="../../enumerable/">Enumerable</a></dd>
</dl> <section class="description"> <h1 id="class-OpenSSL::Config-label-OpenSSL-3A-3AConfig"><a href="../config/">OpenSSL::Config</a></h1> <p>Configuration for the openssl library.</p> <p>Many system's installation of openssl library will depend on your system configuration. See the value of OpenSSL::Config::DEFAULT_CONFIG_FILE for the location of the file for your host.</p> <p>See also <a href="http://www.openssl.org/docs/apps/config.html" target="_blank">www.openssl.org/docs/apps/config.html</a></p> </section> <section id="5Buntitled-5D" class="documentation-section"> <section class="constants-list"> <header> <h3>Constants</h3> </header> <dl> <dt id="DEFAULT_CONFIG_FILE">DEFAULT_CONFIG_FILE </dt>
<dd>
<p>The default system configuration file for openssl</p> </dd>
<dt id="ESCAPE_MAP">ESCAPE_MAP </dt>
<dd>
<p>escaped char map</p> </dd>
<dt id="QUOTE_REGEXP_DQ">QUOTE_REGEXP_DQ </dt>
<dd>
<p>escape with backslash and doubled dq</p> </dd>
<dt id="QUOTE_REGEXP_SQ">QUOTE_REGEXP_SQ </dt>
<dd>
<p>escape with backslash</p> </dd>
</dl> </section> <section id="public-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-new"> <span class="method-name">new</span><span class="method-args">(filename = nil)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Creates an instance of OpenSSL's configuration class.</p> <p>This can be used in contexts like <a href="../x509/extensionfactory/#method-i-config-3D">OpenSSL::X509::ExtensionFactory#config=</a></p> <p>If the optional <code>filename</code> parameter is provided, then it is read in and parsed via parse_config.</p> <p>This can raise <a href="../../io/">IO</a> exceptions based on the access, or availability of the file. A <a href="../configerror/">ConfigError</a> exception may be raised depending on the validity of the data being configured.</p> <div class="method-source-code" id="new-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 245
def initialize(filename = nil)
  @data = {}
  if filename
    File.open(filename.to_s) do |file|
      Config.parse_config(file).each do |section, hash|
        self[section] = hash
      end
    end
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse"> <span class="method-name">parse</span><span class="method-args">(string)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Parses a given <code>string</code> as a blob that contains configuration for openssl.</p> <p>If the source of the <a href="../../io/">IO</a> is a file, then consider using parse_config.</p> <div class="method-source-code" id="parse-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 35
def parse(string)
  c = new()
  parse_config(StringIO.new(string)).each do |section, hash|
    c[section] = hash
  end
  c
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse_config"> <span class="method-name">parse_config</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Parses the configuration data read from <code>io</code>, see also parse.</p> <p>Raises a <a href="../configerror/">ConfigError</a> on invalid configuration data.</p> <div class="method-source-code" id="parse_config-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 51
def parse_config(io)
  begin
    parse_config_lines(io)
  rescue ConfigError =&gt; e
    e.message.replace("error in line #{io.lineno}: " + e.message)
    raise
  end
end</pre> </div> </div> </div> </section> <section id="private-class-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Class Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-c-clear_comments"> <span class="method-name">clear_comments</span><span class="method-args">(line)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="clear_comments-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 176
def clear_comments(line)
  # FCOMMENT
  if m = line.match(/\A([\t\n\f ]*);.*\z/)
    return m[1]
  end
  # COMMENT
  scanned = []
  while m = line.match(/[#'"\]/)
    scanned &lt;&lt; m.pre_match
    c = m[0]
    line = m.post_match
    case c
    when '#'
      line = nil
      break
    when "'", '"'
      regexp = (c == "'") ? QUOTE_REGEXP_SQ : QUOTE_REGEXP_DQ
      scanned &lt;&lt; c
      if m = line.match(regexp)
        scanned &lt;&lt; m[0]
        line = m.post_match
      else
        scanned &lt;&lt; line
        line = nil
        break
      end
    when "\\"
      scanned &lt;&lt; c
      scanned &lt;&lt; line.slice!(0, 1)
    else
      raise 'must not reaced'
    end
  end
  scanned &lt;&lt; line
  scanned.join
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-extract_reference"> <span class="method-name">extract_reference</span><span class="method-args">(value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="extract_reference-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 161
def extract_reference(value)
  rest = ''
  if m = value.match(/\(([^)]*)\)|\{([^}]*)\}/)
    value = m[1] || m[2]
    rest = m.post_match
  elsif [?(, ?{].include?(value[0])
    raise ConfigError, "no close brace"
  end
  if m = value.match(/[a-zA-Z0-9_]*(?:::[a-zA-Z0-9_]*)?/)
    return m[0], m.post_match + rest
  else
    raise
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-get_definition"> <span class="method-name">get_definition</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="get_definition-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 213
def get_definition(io)
  if line = get_line(io)
    while /[^\]\\z/ =~ line
      if extra = get_line(io)
        line += extra
      else
        break
      end
    end
    return line.strip
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-get_line"> <span class="method-name">get_line</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="get_line-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 226
def get_line(io)
  if line = io.gets
    line.gsub(/[\r\n]*/, '')
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-parse_config_lines"> <span class="method-name">parse_config_lines</span><span class="method-args">(io)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="parse_config_lines-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 75
def parse_config_lines(io)
  section = 'default'
  data = {section =&gt; {}}
  while definition = get_definition(io)
    definition = clear_comments(definition)
    next if definition.empty?
    if definition[0] == ?[
      if /\[([^\]]*)\]/ =~ definition
        section = $1.strip
        data[section] ||= {}
      else
        raise ConfigError, "missing close square bracket"
      end
    else
      if /\A([^:\s]*)(?:::([^:\s]*))?\s*=(.*)\z/ =~ definition
        if $2
          section = $1
          key = $2
        else
          key = $1
        end
        value = unescape_value(data, section, $3)
        (data[section] ||= {})[key] = value.strip
      else
        raise ConfigError, "missing equal sign"
      end
    end
  end
  data
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-c-unescape_value"> <span class="method-name">unescape_value</span><span class="method-args">(data, section, value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="unescape_value-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 118
def unescape_value(data, section, value)
  scanned = []
  while m = value.match(/['"\$]/)
    scanned &lt;&lt; m.pre_match
    c = m[0]
    value = m.post_match
    case c
    when "'"
      if m = value.match(QUOTE_REGEXP_SQ)
        scanned &lt;&lt; m[1].gsub(/\(.)/, '\1')
        value = m.post_match
      else
        break
      end
    when '"'
      if m = value.match(QUOTE_REGEXP_DQ)
        scanned &lt;&lt; m[1].gsub(/""/, '').gsub(/\(.)/, '\1')
        value = m.post_match
      else
        break
      end
    when "\\"
      c = value.slice!(0, 1)
      scanned &lt;&lt; (ESCAPE_MAP[c] || c)
    when "$"
      ref, value = extract_reference(value)
      refsec = section
      if ref.index('::')
        refsec, ref = ref.split('::', 2)
      end
      if v = get_key_string(data, refsec, ref)
        scanned &lt;&lt; v
      else
        raise ConfigError, "variable has no value"
      end
    else
      raise 'must not reaced'
    end
  end
  scanned &lt;&lt; value
  scanned.join
end</pre> </div> </div> </div> </section> <section id="public-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Public Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D"> <span class="method-name">[]</span><span class="method-args">(section)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Get a specific <code>section</code> from the current configuration</p> <p>Given the following configurating file being loaded:</p> <pre class="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can get a hash of the specific section like so:</p> <pre class="ruby">config['default']
  #=&gt; {"foo"=&gt;"bar"}
</pre> <div class="method-source-code" id="5B-5D-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 339
def [](section)
  @data[section] || {}
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-5B-5D-3D"> <span class="method-name">[]=</span><span class="method-args">(section, pairs)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Sets a specific <code>section</code> name with a <a href="../../hash/">Hash</a> <code>pairs</code></p> <p>Given the following configuration being created:</p> <pre class="ruby">config = OpenSSL::Config.new
  #=&gt; #&lt;OpenSSL::Config sections=[]&gt;
config['default'] = {"foo"=&gt;"bar","baz"=&gt;"buz"}
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
  #   baz=buz
</pre> <p>It's important to note that this will essentially merge any of the keys in <code>pairs</code> with the existing <code>section</code>. For example:</p> <pre class="ruby">config['default']
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
config['default'] = {"foo" =&gt; "changed"}
  #=&gt; {"foo"=&gt;"changed"}
config['default']
  #=&gt; {"foo"=&gt;"changed", "baz"=&gt;"buz"}
</pre> <div class="method-source-code" id="5B-5D-3D-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 376
def []=(section, pairs)
  check_modify
  @data[section] ||= {}
  pairs.each do |key, value|
    self.add_value(section, key, value)
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-add_value"> <span class="method-name">add_value</span><span class="method-args">(section, key, value)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p><a href="../../set/">Set</a> the target <code>key</code> with a given <code>value</code> under a specific <code>section</code>.</p> <p>Given the following configurating file being loaded:</p> <pre class="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can set the value of <code>foo</code> under the <code>default</code> section to a new value:</p> <pre class="ruby">config.add_value('default', 'foo', 'buzz')
  #=&gt; "buzz"
puts config.to_s
  #=&gt; [ default ]
  #   foo=buzz
</pre> <div class="method-source-code" id="add_value-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 318
def add_value(section, key, value)
  check_modify
  (@data[section] ||= {})[key] = value
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-each"> <span class="method-name">each</span><span class="method-args">() { |section, key, value| ... }</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>For a block.</p> <p>Receive the section and its pairs for the current configuration.</p> <pre class="ruby">config.each do |section, key, value|
  # ...
end
</pre> <div class="method-source-code" id="each-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 437
def each
  @data.each do |section, hash|
    hash.each do |key, value|
      yield [section, key, value]
    end
  end
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-get_value"> <span class="method-name">get_value</span><span class="method-args">(section, key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Gets the value of <code>key</code> from the given <code>section</code></p> <p>Given the following configurating file being loaded:</p> <pre class="ruby">config = OpenSSL::Config.load('foo.cnf')
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
</pre> <p>You can get a specific value from the config if you know the <code>section</code> and <code>key</code> like so:</p> <pre class="ruby">config.get_value('default','foo')
  #=&gt; "bar"
</pre> <div class="method-source-code" id="get_value-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 273
def get_value(section, key)
  if section.nil?
    raise TypeError.new('nil not allowed')
  end
  section = 'default' if section.empty?
  get_key_string(section, key)
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-inspect"> <span class="method-name">inspect</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>String representation of this configuration object, including the class name and its sections.</p> <div class="method-source-code" id="inspect-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 448
def inspect
  "#&lt;#{self.class.name} sections=#{sections.inspect}&gt;"
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-sections"> <span class="method-name">sections</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Get the names of all sections in the current configuration</p> <div class="method-source-code" id="sections-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 386
def sections
  @data.keys
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-to_s"> <span class="method-name">to_s</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <p>Get the parsable form of the current configuration</p> <p>Given the following configuration being created:</p> <pre class="ruby">config = OpenSSL::Config.new
  #=&gt; #&lt;OpenSSL::Config sections=[]&gt;
config['default'] = {"foo"=&gt;"bar","baz"=&gt;"buz"}
  #=&gt; {"foo"=&gt;"bar", "baz"=&gt;"buz"}
puts config.to_s
  #=&gt; [ default ]
  #   foo=bar
  #   baz=buz
</pre> <p>You can parse get the serialized configuration using <a href="../config/#method-i-to_s">to_s</a> and then parse it later:</p> <pre class="ruby">serialized_config = config.to_s
# much later...
new_config = OpenSSL::Config.parse(serialized_config)
  #=&gt; #&lt;OpenSSL::Config sections=["default"]&gt;
puts new_config
  #=&gt; [ default ]
      foo=bar
      baz=buz
</pre> <div class="method-source-code" id="to_s-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 416
def to_s
  ary = []
  @data.keys.sort.each do |section|
    ary &lt;&lt; "[ #{section} ]\n"
    @data[section].keys.each do |key|
      ary &lt;&lt; "#{key}=#{@data[section][key]}\n"
    end
    ary &lt;&lt; "\n"
  end
  ary.join
end</pre> </div> </div> </div> </section> <section id="private-instance-5Buntitled-5D-method-details" class="method-section"> <header> <h3>Private Instance Methods</h3> </header> <div class="method-detail "> <div class="method-heading" id="method-i-check_modify"> <span class="method-name">check_modify</span><span class="method-args">()</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="check_modify-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 464
def check_modify
  raise TypeError.new("Insecure: can't modify OpenSSL config") if frozen?
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-get_key_string"> <span class="method-name">get_key_string</span><span class="method-args">(section, key)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="get_key_string-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 468
def get_key_string(section, key)
  Config.get_key_string(@data, section, key)
end</pre> </div> </div> </div> <div class="method-detail "> <div class="method-heading" id="method-i-initialize_copy"> <span class="method-name">initialize_copy</span><span class="method-args">(other)</span> <a class="method-click-advice">Show source</a> </div> <div class="method-description"> <div class="method-source-code" id="initialize_copy-source"> <pre class="ruby"># File ext/openssl/lib/openssl/config.rb, line 460
def initialize_copy(other)
  @data = other.data.dup
end</pre> </div> </div> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    Ruby Core © 1993–2016 Yukihiro Matsumoto<br>Licensed under the Ruby License.<br>Ruby Standard Library © contributors<br>Licensed under their own licenses.<br>
    
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
