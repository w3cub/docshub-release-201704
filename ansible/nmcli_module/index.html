
<!DOCTYPE HTML>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Nmcli - Ansible - W3cubDocs</title>
  
  <meta name="description" content=" New in version 2.0. ">
  <meta name="keywords" content="nmcli, -, manage, networking, ansible">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="mobile-web-app-capable" content="yes">
  
  <link rel="canonical" href="http://docs.w3cub.com/ansible/nmcli_module/">
  <link href="/favicon.png" rel="icon">
  <link type="text/css" rel="stylesheet" href="/assets/application-50364fff564ce3b6327021805f3f00e2957b441cf27f576a7dd4ff63bbc47047.css">
  <script type="text/javascript" src="/assets/application-db64bfd54ceb42be11af7995804cf4902548419ceb79d509b0b7d62c22d98e6f.js"></script>
  <script src="/json/ansible.js"></script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71174418-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body>
	<div class="_app">
	<header class="_header">
  
  <form class="_search">
    <input type="search" class="_search-input" placeholder="Search&hellip;" autocomplete="off" autocapitalize="off" autocorrect="off" spellcheck="false" maxlength="20">
    <a class="_search-clear"></a>
    <div class="_search-tag"></div>
  </form>
  
  <a class="_home-link" href="/" ></a>
  <a class="_menu-link"></a>
  <h1 class="_logo">
    <a href="/" class="_nav-link" title="API Documentation Browser">W3cubDocs</a>
  </h1>
  
  <span class="_logo-sub-nav">/</span><span class="_logo-sub-nav"><a href="/ansible/" class="_nav-link" title="" style="margin-left:0;">Ansible</a></span>
  
  <nav class="_nav">
    <a href="/app/" class="_nav-link ">App</a>
    <a href="/about/" class="_nav-link ">About</a>
  </nav>
</header>
	<section class="_sidebar">
		<div class="_list">
			
		</div>
	</section>
	<section class="_container ">
		<div class="_content">
			<div class="_page _sphinx">
				
<h1 id="nmcli">nmcli - Manage Networking</h1> <div class="versionadded" id="nmcli-manage-networking"> <p><span class="versionmodified">New in version 2.0.</span></p> </div>  <ul class="simple"> <li><a class="reference internal" href="#synopsis" id="id1">Synopsis</a></li> <li><a class="reference internal" href="#requirements-on-host-that-executes-module" id="id2">Requirements (on host that executes module)</a></li> <li><a class="reference internal" href="#options" id="id3">Options</a></li> <li><a class="reference internal" href="#examples" id="id4">Examples</a></li> <li><a class="reference internal" href="#this-is-an-extras-module" id="id5">This is an Extras Module</a></li> </ul>   <h2 id="synopsis">Synopsis</h2> <p>Manage the network devices. Create, modify, and manage, ethernet, teams, bonds, vlans etc.</p>   <h2 id="requirements-on-host-that-executes-module">Requirements (on host that executes module)</h2>  <ul class="simple"> <li>nmcli</li> <li>dbus</li> </ul>    <h2 id="options">Options</h2> <table> <tr> <th class="head">parameter</th> <th class="head">required</th> <th class="head">default</th> <th class="head">choices</th> <th class="head">comments</th> </tr> <tr> <td>ageingtime<br>
</td> <td>no</td> <td>300</td> <td></td> <td><div>This is only used with bridge - [ageing-time &lt;0-1000000&gt;] the Ethernet MAC address aging time, in seconds</div></td>
</tr> <tr> <td>arp_interval<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bond - ARP interval</div></td>
</tr> <tr> <td>arp_ip_target<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bond - ARP IP target</div></td>
</tr> <tr> <td>autoconnect<br>
</td> <td>no</td> <td>yes</td> <td><ul>
<li>yes</li>
<li>no</li>
</ul></td> <td>
<div>Whether the connection should start on boot.</div>
<div>Whether the connection profile can be automatically activated</div>
</td>
</tr> <tr> <td>conn_name<br>
</td> <td>yes</td> <td></td> <td></td> <td><div>Where conn_name will be the name used to call the connection. when not provided a default name is generated: &lt;type&gt;[-&lt;ifname&gt;][-&lt;num&gt;]</div></td>
</tr> <tr> <td>dns4<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>A list of upto 3 dns servers, ipv4 format e.g. To add two IPv4 DNS server addresses: ["192.0.2.53", "198.51.100.53"]</div></td>
</tr> <tr> <td>dns6<br>
</td> <td>no</td> <td></td> <td></td> <td><div>A list of upto 3 dns servers, ipv6 format e.g. To add two IPv6 DNS server addresses: ["2001:4860:4860::8888 2001:4860:4860::8844"]</div></td>
</tr> <tr> <td>downdelay<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bond - downdelay</div></td>
</tr> <tr> <td>egress<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with VLAN - VLAN egress priority mapping</div></td>
</tr> <tr> <td>flags<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with VLAN - flags</div></td>
</tr> <tr> <td>forwarddelay<br>
</td> <td>no</td> <td>15</td> <td></td> <td><div>This is only used with bridge - [forward-delay &lt;2-30&gt;] STP forwarding delay, in seconds</div></td>
</tr> <tr> <td>gw4<br>
</td> <td>no</td> <td></td> <td></td> <td><div>The IPv4 gateway for this interface using this format ie: "192.0.2.1"</div></td>
</tr> <tr> <td>gw6<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>The IPv6 gateway for this interface using this format ie: "2001:db8::1"</div></td>
</tr> <tr> <td>hairpin<br>
</td> <td>no</td> <td>True</td> <td></td> <td><div>This is only used with 'bridge-slave' - 'hairpin mode' for the slave, which allows frames to be sent back out through the slave the frame was received on.</div></td>
</tr> <tr> <td>hellotime<br>
</td> <td>no</td> <td>2</td> <td></td> <td><div>This is only used with bridge - [hello-time &lt;1-10&gt;] STP hello time, in seconds</div></td>
</tr> <tr> <td>ifname<br>
</td> <td>no</td> <td>conn_name</td> <td></td> <td>
<div>Where IFNAME will be the what we call the interface name.</div>
<div>interface to bind the connection to. The connection will only be applicable to this interface name.</div>
<div>A special value of "*" can be used for interface-independent connections.</div>
<div>The ifname argument is mandatory for all connection types except bond, team, bridge and vlan.</div>
</td>
</tr> <tr> <td>ingress<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with VLAN - VLAN ingress priority mapping</div></td>
</tr> <tr> <td>ip4<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>The IPv4 address to this interface using this format ie: "192.0.2.24/24"</div></td>
</tr> <tr> <td>ip6<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>The IPv6 address to this interface using this format ie: "abbe::cafe"</div></td>
</tr> <tr> <td>mac<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bridge - MAC address of the bridge (note: this requires a recent kernel feature, originally introduced in 3.15 upstream kernel)</div></td>
</tr> <tr> <td>master<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>master &lt;master (ifname, or connection UUID or conn_name) of bridge, team, bond master connection profile.</div></td>
</tr> <tr> <td>maxage<br>
</td> <td>no</td> <td>20</td> <td></td> <td><div>This is only used with bridge - [max-age &lt;6-42&gt;] STP maximum message age, in seconds</div></td>
</tr> <tr> <td>miimon<br>
</td> <td>no</td> <td>100</td> <td></td> <td><div>This is only used with bond - miimon</div></td>
</tr> <tr> <td>mode<br>
</td> <td>no</td> <td>balence-rr</td> <td><ul>
<li>balance-rr</li>
<li>active-backup</li>
<li>balance-xor</li>
<li>broadcast</li>
<li>802.3ad</li>
<li>balance-tlb</li>
<li>balance-alb</li>
</ul></td> <td><div>This is the type of device or network connection that you wish to create for a bond, team or bridge.</div></td>
</tr> <tr> <td>mtu<br>
</td> <td>no</td> <td>1500</td> <td></td> <td>
<div>The connection MTU, e.g. 9000. This can't be applied when creating the interface and is done once the interface has been created.</div>
<div>Can be used when modifying Team, VLAN, Ethernet (Future plans to implement wifi, pppoe, infiniband)</div>
</td>
</tr> <tr> <td>path_cost<br>
</td> <td>no</td> <td>100</td> <td></td> <td><div>This is only used with 'bridge-slave' - [&lt;1-65535&gt;] - STP port cost for destinations via this slave</div></td>
</tr> <tr> <td>primary<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bond and is the primary interface name (for "active-backup" mode), this is the usually the 'ifname'</div></td>
</tr> <tr> <td>priority<br>
</td> <td>no</td> <td>128</td> <td></td> <td><div>This is only used with 'bridge' - sets STP priority</div></td>
</tr> <tr> <td>slavepriority<br>
</td> <td>no</td> <td>32</td> <td></td> <td><div>This is only used with 'bridge-slave' - [&lt;0-63&gt;] - STP priority of this slave</div></td>
</tr> <tr> <td>state<br>
</td> <td>yes</td> <td></td> <td><ul>
<li>present</li>
<li>absent</li>
</ul></td> <td><div>Whether the device should exist or not, taking action if the state is different from what is stated.</div></td>
</tr> <tr> <td>stp<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bridge and controls whether Spanning Tree Protocol (STP) is enabled for this bridge</div></td>
</tr> <tr> <td>type<br>
</td> <td>no</td> <td></td> <td><ul>
<li>ethernet</li>
<li>team</li>
<li>team-slave</li>
<li>bond</li>
<li>bond-slave</li>
<li>bridge</li>
<li>vlan</li>
</ul></td> <td><div>This is the type of device or network connection that you wish to create.</div></td>
</tr> <tr> <td>updelay<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with bond - updelay</div></td>
</tr> <tr> <td>vlandev<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with VLAN - parent device this VLAN is on, can use ifname</div></td>
</tr> <tr> <td>vlanid<br>
</td> <td>no</td> <td>None</td> <td></td> <td><div>This is only used with VLAN - VLAN ID in range &lt;0-4095&gt;</div></td>
</tr> </table>   <h2 id="examples">Examples</h2>  <pre data-language="yaml">The following examples are working examples that I have run in the field. I followed follow the structure:
```
|_/inventory/cloud-hosts
|           /group_vars/openstack-stage.yml
|           /host_vars/controller-01.openstack.host.com
|           /host_vars/controller-02.openstack.host.com
|_/playbook/library/nmcli.py
|          /playbook-add.yml
|          /playbook-del.yml
```

## inventory examples
### groups_vars
```yml
---
#devops_os_define_network
storage_gw: "192.0.2.254"
external_gw: "198.51.100.254"
tenant_gw: "203.0.113.254"

#Team vars
nmcli_team:
    - {conn_name: 'tenant', ip4: "{{tenant_ip}}", gw4: "{{tenant_gw}}"}
    - {conn_name: 'external', ip4: "{{external_ip}}", gw4: "{{external_gw}}"}
    - {conn_name: 'storage', ip4: "{{storage_ip}}", gw4: "{{storage_gw}}"}
nmcli_team_slave:
    - {conn_name: 'em1', ifname: 'em1', master: 'tenant'}
    - {conn_name: 'em2', ifname: 'em2', master: 'tenant'}
    - {conn_name: 'p2p1', ifname: 'p2p1', master: 'storage'}
    - {conn_name: 'p2p2', ifname: 'p2p2', master: 'external'}

#bond vars
nmcli_bond:
    - {conn_name: 'tenant', ip4: "{{tenant_ip}}", gw4: '', mode: 'balance-rr'}
    - {conn_name: 'external', ip4: "{{external_ip}}", gw4: '', mode: 'balance-rr'}
    - {conn_name: 'storage', ip4: "{{storage_ip}}", gw4: "{{storage_gw}}", mode: 'balance-rr'}
nmcli_bond_slave:
    - {conn_name: 'em1', ifname: 'em1', master: 'tenant'}
    - {conn_name: 'em2', ifname: 'em2', master: 'tenant'}
    - {conn_name: 'p2p1', ifname: 'p2p1', master: 'storage'}
    - {conn_name: 'p2p2', ifname: 'p2p2', master: 'external'}

#ethernet vars
nmcli_ethernet:
    - {conn_name: 'em1', ifname: 'em1', ip4: "{{tenant_ip}}", gw4: "{{tenant_gw}}"}
    - {conn_name: 'em2', ifname: 'em2', ip4: "{{tenant_ip1}}", gw4: "{{tenant_gw}}"}
    - {conn_name: 'p2p1', ifname: 'p2p1', ip4: "{{storage_ip}}", gw4: "{{storage_gw}}"}
    - {conn_name: 'p2p2', ifname: 'p2p2', ip4: "{{external_ip}}", gw4: "{{external_gw}}"}
```

### host_vars
```yml
---
storage_ip: "192.0.2.91/23"
external_ip: "198.51.100.23/21"
tenant_ip: "203.0.113.77/23"
```



## playbook-add.yml example

```yml
---
- hosts: openstack-stage
  remote_user: root
  tasks:

- name: install needed network manager libs
  yum: name={{ item }} state=installed
  with_items:
    - NetworkManager-glib
    - libnm-qt-devel.x86_64
    - nm-connection-editor.x86_64
    - libsemanage-python
    - policycoreutils-python

##### Working with all cloud nodes - Teaming
  - name: try nmcli add team - conn_name only &amp; ip4 gw4
    nmcli: type=team conn_name={{item.conn_name}} ip4={{item.ip4}} gw4={{item.gw4}} state=present
    with_items:
      - "{{nmcli_team}}"

  - name: try nmcli add teams-slave
    nmcli: type=team-slave conn_name={{item.conn_name}} ifname={{item.ifname}} master={{item.master}} state=present
    with_items:
      - "{{nmcli_team_slave}}"

###### Working with all cloud nodes - Bonding
#  - name: try nmcli add bond - conn_name only &amp; ip4 gw4 mode
#    nmcli: type=bond conn_name={{item.conn_name}} ip4={{item.ip4}} gw4={{item.gw4}} mode={{item.mode}} state=present
#    with_items:
#      - "{{nmcli_bond}}"
#
#  - name: try nmcli add bond-slave
#    nmcli: type=bond-slave conn_name={{item.conn_name}} ifname={{item.ifname}} master={{item.master}} state=present
#    with_items:
#      - "{{nmcli_bond_slave}}"

##### Working with all cloud nodes - Ethernet
#  - name: nmcli add Ethernet - conn_name only &amp; ip4 gw4
#    nmcli: type=ethernet conn_name={{item.conn_name}} ip4={{item.ip4}} gw4={{item.gw4}} state=present
#    with_items:
#      - "{{nmcli_ethernet}}"
```

## playbook-del.yml example

```yml
---
- hosts: openstack-stage
  remote_user: root
  tasks:

  - name: try nmcli del team - multiple
    nmcli: conn_name={{item.conn_name}} state=absent
    with_items:
      - { conn_name: 'em1'}
      - { conn_name: 'em2'}
      - { conn_name: 'p1p1'}
      - { conn_name: 'p1p2'}
      - { conn_name: 'p2p1'}
      - { conn_name: 'p2p2'}
      - { conn_name: 'tenant'}
      - { conn_name: 'storage'}
      - { conn_name: 'external'}
      - { conn_name: 'team-em1'}
      - { conn_name: 'team-em2'}
      - { conn_name: 'team-p1p1'}
      - { conn_name: 'team-p1p2'}
      - { conn_name: 'team-p2p1'}
      - { conn_name: 'team-p2p2'}
```
# To add an Ethernet connection with static IP configuration, issue a command as follows
- nmcli: conn_name=my-eth1 ifname=eth1 type=ethernet ip4=192.0.2.100/24 gw4=192.0.2.1 state=present

# To add an Team connection with static IP configuration, issue a command as follows
- nmcli: conn_name=my-team1 ifname=my-team1 type=team ip4=192.0.2.100/24 gw4=192.0.2.1 state=present autoconnect=yes

# Optionally, at the same time specify IPv6 addresses for the device as follows:
- nmcli: conn_name=my-eth1 ifname=eth1 type=ethernet ip4=192.0.2.100/24 gw4=192.0.2.1 ip6=2001:db8::cafe gw6=2001:db8::1 state=present

# To add two IPv4 DNS server addresses:
-nmcli: conn_name=my-eth1 dns4=["192.0.2.53", "198.51.100.53"] state=present

# To make a profile usable for all compatible Ethernet interfaces, issue a command as follows
- nmcli: ctype=ethernet name=my-eth1 ifname="*" state=present

# To change the property of a setting e.g. MTU, issue a command as follows:
- nmcli: conn_name=my-eth1 mtu=9000 type=ethernet state=present

    Exit Status's:
        - nmcli exits with status 0 if it succeeds, a value greater than 0 is
        returned if an error occurs.
        - 0 Success - indicates the operation succeeded
        - 1 Unknown or unspecified error
        - 2 Invalid user input, wrong nmcli invocation
        - 3 Timeout expired (see --wait option)
        - 4 Connection activation failed
        - 5 Connection deactivation failed
        - 6 Disconnecting device failed
        - 7 Connection deletion failed
        - 8 NetworkManager is not running
        - 9 nmcli and NetworkManager versions mismatch
        - 10 Connection, device, or access point does not exist.
</pre>    <h2 id="this-is-an-extras-module">This is an Extras Module</h2> <p>For more information on what this means please read <a class="reference internal" href="../modules_extra/"><span class="doc">Extras Modules</span></a></p> <p>For help in developing on modules, should you be so inclined, please read <a class="reference internal" href="https://docs.ansible.com/ansible/community.html" target="_blank"><span class="doc">Community Information &amp; Contributing</span></a>, <span class="xref doc">developing_test_pr</span> and <a class="reference internal" href="../developing_modules/"><span class="doc">Developing Modules</span></a>.</p>
<div class="_attribution">
  <p class="_attribution-p">
    © 2012–2016 Michael DeHaan<br>© 2016 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/nmcli_module.html" class="_attribution-link" target="_blank">https://docs.ansible.com/ansible/nmcli_module.html</a>
  </p>
</div>

			</div>
		</div>
	</section>

	</div>
</body>
</html>
